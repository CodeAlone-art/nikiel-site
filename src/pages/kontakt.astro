---
import BaseLayout from "../layouts/BaseLayout.astro";
import Navbar from "../components/Navbar.astro";
---

<BaseLayout title="Kontakt â€“ NIKIEL">
  <Navbar />
  <div class="nav-spacer" aria-hidden="true"></div>

  <div class="kontakt-container">
    <div class="left" onclick="window.location.href='/'" aria-label="PowrÃ³t do strony gÅ‚Ã³wnej"></div>

    <div class="right">
      <form id="contact-form" action="/api/contact" method="POST" class="form-editorial">
        <header class="form-head">
          <span class="tagline">Studio / Portfolio</span>
          <h2 class="title">
            SKONTAKTUJ SIÄ˜ Z NI<span class="k-flip">K</span>IEL
          </h2>
          <p class="sub">Jedno zdanie wystarczy. MoÅ¼esz wpaÅ›Ä‡ z linkiem do pracy, ideÄ…, pytaniem.</p>
        </header>

        <div class="field">
          <label for="name">IMIÄ˜ I NAZWISKO</label>
          <input id="name" name="name" type="text" placeholder="Twoje imiÄ™" required />
          <div class="underline"></div>
        </div>

        <div class="field">
          <label for="email">E-MAIL</label>
          <input id="email" name="email" type="email" placeholder="adres@twojemail.com" required />
          <div class="underline"></div>
        </div>

        <div class="field">
          <label for="subject">TEMAT</label>
          <input id="subject" name="subject" type="text" placeholder="Temat wiadomoÅ›ci (opcjonalnie)" />
          <div class="underline"></div>
        </div>

        <div class="field">
          <label for="message">WIADOMOÅšÄ†</label>
          <textarea id="message" name="message" placeholder="Napisz krÃ³tko. Linki mile widziane." required></textarea>
          <div class="underline"></div>
        </div>

        <div class="cf-turnstile" data-sitekey={import.meta.env.PUBLIC_TURNSTILE_SITE_KEY}></div>

        <div class="actions">
          <button type="submit" class="btn-ghost">WyÅ›lij</button>
          <span class="hint">Odpowiadamy zwykle w ciÄ…gu 24h.</span>
        </div>

        <p id="form-ok" class="status ok" hidden>DziÄ™kujemy! WiadomoÅ›Ä‡ zostaÅ‚a wysÅ‚ana.</p>
        <p id="form-err" class="status err" hidden>Upsâ€¦ CoÅ› poszÅ‚o nie tak. SprÃ³buj ponownie.</p>
      </form>
    </div>
  </div>

  <script is:inline>
    const form = document.getElementById('contact-form');
    const ok = document.getElementById('form-ok');
    const err = document.getElementById('form-err');

    if (form) {
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        if (ok) ok.hidden = true;
        if (err) err.hidden = true;

        const fd = new FormData(form);
        const subj = (fd.get('subject') || '').toString().trim();
        if (subj) {
          const msg = (fd.get('message') || '').toString();
          fd.set('message', `Temat: ${subj}\n\n${msg}`);
        }

        try {
          // ðŸ”¹ Dla lokalnych testÃ³w (VSC) â€” bez bÅ‚Ä™dÃ³w gdy backend nieaktywny
          const res = await fetch(form.action, { method: 'POST', body: fd }).catch(() => null);
          if (!res) {
            console.log("Tryb lokalny: backend /api/contact nieaktywny.");
            ok.hidden = false;
            return;
          }

          const data = await res.json().catch(() => ({}));
          if (data.ok) {
            if (err) err.hidden = true;
            if (ok) ok.hidden = false;
            form.reset();
            if (window.turnstile) window.turnstile.reset();
          } else {
            if (ok) ok.hidden = true;
            if (err) err.hidden = false;
            console.error('Contact error:', data.error || res.statusText);
          }
        } catch {
          if (ok) ok.hidden = true;
          if (err) err.hidden = false;
        }
      });
    }
  </script>

  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>

  <style>
    :root{
      --bg:#0f0f0f;
      --panel:#121212;
      --ink:#f5f5f5;
      --muted:#9b9b9b;
      --accent:#ffcc00;
      --line:#2a2a2a;
      --line-strong:#3a3a3a;
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: var(--bg);
      color: var(--ink);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    .nav-spacer { height: 64px; }

    .kontakt-container {
      position: fixed;
      top: 64px;
      left: 0;
      width: 100%;
      height: calc(100vh - 64px);
      display: flex;
      flex-direction: row;
      overflow: hidden;
    }

    .left, .right { flex: 0 0 50%; height: 100%; }

    .left {
      background: linear-gradient(to bottom, rgba(0,0,0,.15), rgba(0,0,0,.4)),
                  url("/images/tlo1.png") center center / cover no-repeat;
      transition: transform .5s ease, filter .5s ease;
      cursor: pointer;
      filter: saturate(0.9) contrast(1.05);
    }
    .left:hover { transform: scale(1.03); filter: saturate(1) contrast(1.1); }

    .right {
      background: radial-gradient(1200px 700px at 30% 10%, rgba(255,255,255,0.06), transparent),
                  var(--panel);
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 2rem 3rem;
    }

    .form-editorial {
      width: 100%;
      max-width: 560px;
      display: flex;
      flex-direction: column;
      gap: 1.2rem;
      padding: 2rem 2.2rem;
      border: 1px solid rgba(255,255,255,0.08);
      background: rgba(18,18,18,0.65);
      box-shadow: 0 10px 40px rgba(0,0,0,.35);
      border-radius: 16px;
      backdrop-filter: blur(8px);
    }

    .form-head { margin-bottom: .2rem; }
    .form-head .tagline{
      letter-spacing:.18em;
      font-size:.7rem;
      color: var(--muted);
      text-transform: uppercase;
    }
    .form-head .title{
      margin: .2rem 0 .35rem;
      font-size: clamp(1.6rem, 2.6vw, 2.2rem);
      line-height: 1.1;
      font-weight: 700;
      letter-spacing: .02em;
      font-kerning: normal;
      white-space: nowrap;
    }
    .k-flip{
      display:inline-block;
      transform: scaleX(-1);
      transform-origin: 50% 50%;
      margin-left: -0.06em;
      margin-right: -0.02em;
    }
    .form-head .sub{
      margin: 0;
      font-size: .95rem;
      color: var(--muted);
    }

    .field{ position: relative; display:flex; flex-direction:column; gap:.35rem; }
    .field label{
      font-size: .75rem;
      letter-spacing: .12em;
      color: var(--muted);
      text-transform: uppercase;
    }

    .field input,
    .field textarea{
      width: 100%;
      background: transparent;
      color: var(--ink);
      border: none;
      outline: none;
      padding: .6rem 0 .55rem;
      font-size: 1.02rem;
    }

    .field textarea{ resize: vertical; min-height: 120px; max-height: 320px; }

    .field .underline{
      height: 1px;
      background: linear-gradient(90deg, var(--line), var(--line-strong));
      transform-origin: left;
      transition: transform .3s ease, background .3s ease;
    }

    .field:focus-within .underline{
      transform: scaleX(1.02);
      background: linear-gradient(90deg, var(--accent) 0%, #ffe680 100%);
      box-shadow: 0 0 0 1px rgba(255,204,0,.15);
    }

    ::placeholder{ color: #7d7d7d; opacity:.85; }

    .actions{
      display:flex; align-items:center; gap:1rem; margin-top:.4rem;
    }

    .btn-ghost{
      appearance: none;
      border: 1px solid rgba(255,255,255,.35);
      background: transparent;
      color: var(--ink);
      padding: .85rem 1.2rem;
      border-radius: 999px;
      font-weight: 700;
      letter-spacing: .04em;
      cursor: pointer;
      transition: border-color .25s ease, transform .08s ease, background .25s ease, color .25s ease;
    }
    .btn-ghost:hover{
      border-color: var(--accent);
      background: rgba(255,204,0,.08);
    }
    .btn-ghost:active{ transform: translateY(1px) scale(.99); }

    .hint{
      color: var(--muted);
      font-size: .9rem;
    }

    .status{
      margin:.25rem 0 0;
      font-size:.95rem;
      padding:.6rem .8rem;
      border-radius: 10px;
      background: rgba(255,255,255,.06);
      display:inline-block;
    }
    .status.ok{ border:1px solid rgba(120,200,120,.35); color:#cfeaca; }
    .status.err{ border:1px solid rgba(255,120,120,.35); color:#ffd1d1; }
    .status[hidden]{ display:none!important; }

    @media (max-width: 900px) {
      .kontakt-container {
        position: static;
        flex-direction: column;
        height: auto;
      }
      .left { height: 300px; }
      .right { padding: 2rem 1.2rem; }
      .form-editorial{ padding: 1.6rem 1.4rem; }
    }
  </style>
</BaseLayout>
